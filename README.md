# colobot-lint

This is a static analysis tool designed for use with source code of [open-source Colobot project](http://github.com/colobot/colobot).

It currently implements a few checks for consistent coding style and potentially problematic portions of code. Although it is designed specifically to help in development of Colobot, you may find it generic enough to use in your own projects. If so, you are welcome to do it.

It uses Clang's extensive API to implement a tool that "sees" the code exactly as the compiler does, which lets it directly analyze AST generated by compiler, and if needed, even go low level and process each parsed token.

If you're not familiar with Clang's LibTooling, you should start by reading [a few tutorials](http://clang.llvm.org/docs/LibASTMatchersTutorial.html).

# Compiling

There are two possible ways of compiling colobot-lint:
 - along with Clang and LLVM sources,
 - as standalone project using installed Clang headers and libraries.

The second method is so far very experimental and probably only works on one system (Arch Linux).

# Requirements

You obviously need Clang, either its source files (see below), or have it installed normally on your system.
Please note that the only supported version of Clang is 3.6, and it will probably stay that way to avoid hassle with changing APIs.

The other requirements necessary for compilation are basically same as for Clang (see for example [this](http://llvm.org/docs/GettingStarted.html)).
However, you will also need:
 - CMake >= 2.8
 - tinyxml >= 2.6
 - Boost regex >= 1.49

## Compiling along with Clang and LLVM sources

Download the following files from [LLVM project download page](http://llvm.org/releases/download.html):
 - `llvm-3.6*.tar.xz` (LLVM sources)
 - `cfe-3.6*.tar.xz` (Clang sources)
 - `clang-tools-extra-3.6*.tar.xz` (Clang Tools Extra)

Now unpack them as follows:
```
 $ tar -Jxf llvm-3.6*.tar.xz
 $ tar -Jxf cfe-3.6*.tar.xz
 $ tar -Jxf clang-tools-extra-3.6*.tar.xz
 $ mv llvm-3.6*/ llvm
 $ mv cfe-3.6*/ llvm/tools/clang
 $ mv clang-tools-extra-3.6*/ llvm/tools/clang/tools/extra
```

Clone this repository:
```
 $ git clone https://github.com/piotrdz/colobot-lint.git
```

Create symlinks in clang sources and add it to appropriate CMakeLists.txt:
```
 $ ln -s $PWD/colobot-lint llvm/tools/clang/tools/extra/colobot-lint
 $ echo "add_subdirectory(colobot-lint)" >> llvm/tools/clang/tools/extra/CMakeLists.txt
```

Now you can build everything together:
```
 $ mkdir clang-build
 $ cd clang-build
 $ cmake -DCMAKE_BUILD_TYPE=Release ../llvm
 $ make
```

The binary should be created in `./bin/colobot-lint`. You can install it wherever you like.

## Compiling standalone

Try this and keep your fingers crossed:
```
 $ git clone https://github.com/piotrdz/colobot-lint.git
 $ mkdir colobot-lint-build
 $ cd colobot-lint-build
 $ cmake -DCMAKE_BUILD_TYPE=Release ../colobot-lint
 $ make
```

The binary should be saved in `./colobot-lint`. You can install it wherever you like.

# Running

To run the tool, you first need to generate compilation database for Colobot:
```
 $ git clone --recursive https://github.com/colobot/colobot.git
 $ mkdir colobot-build
 $ cd colobot-build
 $ cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=1 ../colobot
 $ cd ..
```

This is enough, you don't need to run `make` itself. Everything that this tool needs is file `compile_commands.json` which should appear inside `colobot-build`.

Now we can run the tool itself:
```
 $ colobot-lint -verbose -output-file=report.xml -p $PWD/colobot-build $(find $PWD/colobot/src -name '*.cpp')
```

(Note the use of `$PWD` - you need to supply full paths to files, exactly as they appear in `compile_commands.json`)

The file `report.xml` contains list of reported problems in a format compatible with that of cppcheck. This is so that you can use it with cppcheck plugin for Jenkins.


# License
colobot-lint is licensed under BSD license (see LICENSE.txt).
